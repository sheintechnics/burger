$(document).ready(function() {
  /*Hamburger menu*/
  let hamburger = (options => {
    let button = document.querySelector(options.button);
    let menu = document.querySelector(options.menu);
    let body = document.querySelector("body");

    let itemsList = document.getElementById("nav__list--hamburger").children;
    itemsList = Array.prototype.slice.call(itemsList);

    const items = $(".nav__item", menu);
    let counter = 0;

    let startMenuAnimation = function startMenuAnimation() {
      let item = items.eq(counter);
      item.toggleClass("pulse");
      counter++;
      if (counter < items.length) {
        setTimeout(startMenuAnimation, 100);
      }
      if (counter === items.length) counter = 0;
    };

    let _toggleMenu = function(e) {
      button.classList.toggle("is-active");
      menu.classList.toggle("is-active");
      body.classList.toggle("locked");
      startMenuAnimation();
    };

    var closeMenu = function closeMenu() {
      button.classList.remove("is-active");
      menu.classList.remove("is-active");
      body.classList.remove("locked");
      startMenuAnimation();
    };

    let addListeners = function() {
      button.addEventListener("click", _toggleMenu);

      for (i = 0; i < itemsList.length; i++) {
        itemsList[i].addEventListener("click", closeMenu);
      }
    };

    document.addEventListener("keydown", function(e) {
      if (e.keyCode == 27) closeMenu();
    });

    return {
      init: addListeners
    };
  })({
    button: "#hamburger-menu-link",
    menu: "#hamburger-menu"
  });

  hamburger.init();

  /*horaccordeon*/
  let teamAccoJS = () => {
    let oTeamLink = document.querySelectorAll(".team__accordeon-link");

    oTeamLink.forEach(function(personName) {

      personName.addEventListener("click", function(e) {
        e.preventDefault();
        let activePerson = document.querySelector(".team__accordeon-item.is-active");

        if (activePerson) {
          let teamAccordeonDesc = activePerson.querySelector(".team__accordeon-desc")

          teamAccordeonDesc.style.height = "0px";
          activePerson.classList.remove("is-active");
        }

        if (!activePerson || activePerson.querySelector(".team__accordeon-link") !== this) {
          let currentPerson = this.closest(".team__accordeon-item");
          currentPerson.classList.add("is-active");

          let currentPersonInfo = currentPerson.querySelector(".team__accordeon-desc");
          currentPersonInfo.style.height = currentPersonInfo.scrollHeight + "px";
        }
      })
    })
  };
  teamAccoJS();

  /*veraccordeon*/
  let verticalAcco = () => {
    let calculateWidth = () => {
      let windowWidth = $(window).width();
      let links = $(".menu__accordeon-link");
      let linksWidth = links.width();
      let reqWidth = windowWidth - linksWidth * links.length;
      return reqWidth > 550 ? 550 : reqWidth;
    };
    let oTeamLink = document.querySelectorAll(".menu__accordeon-link");
    oTeamLink.forEach(function(personName) {

      personName.addEventListener("click", function(e) {
        e.preventDefault();
        let activePerson = document.querySelector(".menu__accordeon-item.active");
        // let otherPerson = document.querySellectorAll(".menu__accordeon-item");

        if (activePerson) {
          let teamAccordeonDesc = activePerson.querySelector(".menu__accordeon-content");

          teamAccordeonDesc.style.width = "0px";
          activePerson.classList.remove("active");
        }

        if (!activePerson || activePerson.querySelector(".menu__accordeon-link") !== this) {
          let currentPerson = this.closest(".menu__accordeon-item");
          currentPerson.classList.remove("hidden");
          currentPerson.classList.add("active");

          let currentPersonInfo = currentPerson.querySelector(".menu__accordeon-content");
          currentPersonInfo.style.width = calculateWidth() + "px";
        }
      })
    })
  };
  verticalAcco();

  /*Slider*/
  let owlCarousel = () => {
    const burgerCarousel = $(".slider__list").owlCarousel({
      items: 1,
      nav: true,
      navContainer: $(".slider__controls"),
      navText: ["", ""],
      loop: true
    });

    $(".slider__btn-next").on("click", e => {
      e.preventDefault();
      burgerCarousel.trigger("next.owl.carousel");
    });

    $(".slider__btn-prev").on("click", e => {
      e.preventDefault();
      burgerCarousel.trigger("prev.owl.carousel");
    });
  };

  owlCarousel();
  
  /*Modal*/
  $('.feedback__btn').on("click", function(e){
    e.preventDefault();
    $('.overlay-modal').show();
    $('.modal-feedback__content').text('Мысли все о них и о них, о них и о них. Нельзя устоять, невозможно забыть... Никогда не думал, что булочки могут быть такими мягкими, котлетка такой сочной, а сыр таким расплавленным. Мысли все о них и о них, о них и о них. Нельзя устоять, невозможно забыть... Никогда не думал, что булочки могут быть такими мягкими, котлетка такой сочной, а сыр таким расплавленным.');
    $('.modal-feedback__title').text('Константин спилберг');
    // $("html,body").css("overflow","hidden");
  });
  $('.modal-feedback__close').on("click", function(e){
    e.preventDefault();
    $('.overlay-modal').hide();
    // $("html,body").css("overflow","inherit");
  });

  /*AJAX form*/
  var ajaxForm = function (mainform) {
    let formData = new FormData();
      formData.append("name", mainform.elements.name.value);
      formData.append("phone", mainform.elements.phone.value);
      formData.append("comment", mainform.elements.comment.value);
      formData.append("to", "kur.ser@mail.ru");
    let url = "https://webdev-api.loftschool.com/sendmail";

    const xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("POST", url);
    xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
    xhr.send(formData);
    //xhr.send(JSON.stringify(data));
    return xhr;
  }

  var submitForm = function (e){
    e.preventDefault();
    var form = e.target;
    let request = ajaxForm(mainform);

    request.addEventListener('load', () => {
      if (request.status >= 400) {
        let content = 'Ошибка соединения с сервером, попробуйте позже.';
        $('.modal-feedback__content').text(content + ' Ошибка ' + request.status + '!');
        $('.modal-feedback__title').text('Результат отправки');
        $('.overlay-modal').show();
      } else if (request.response.status) {
        let content = request.response.message;
        $('.modal-feedback__content').text(content);
        $('.modal-feedback__title').text('Результат отправки');
        $('.overlay-modal').show();
      } else {
        let content = request.response.message;
        $('.modal-feedback__content').text(content);
        $('.modal-feedback__title').text('Результат отправки');
        $('.overlay-modal').show();
      }
    });
  }
  let myform = document.querySelector('#mainform');
  myform.addEventListener('submit', submitForm);

  ymaps.ready(init);
  var myMap,
    myPlacemark,
    myPlacemarks = [
      {
        latitude: 59.915038,
        longitude: 30.486096,
        hintContent: "Mr.Burger на Товарищеском",
        balloonContent: "Товарищеский проспект, 20/27"
      },
      {
        latitude: 59.94708381,
        longitude: 30.38481688,
        hintContent: "Mr.Burger на Тверской",
        balloonContent: "Тверская улица, 16"
      },
      {
        latitude: 59.891295,
        longitude: 30.316907,
        hintContent: "Mr.Burger на Московском",
        balloonContent: "Московский проспект, 103к2"
      },
      {
        latitude: 59.973999,
        longitude: 30.311091,
        hintContent: "Mr.Burger на Чапыгина",
        balloonContent: "улица Чапыгина, 13А"
      }
    ];

  function init() {
    myMap = new ymaps.Map("map", {
      center: [59.92606548, 30.32610869],
      zoom: 11
    });

    myPlacemarks.forEach(function(obj) {
      myPlacemark = new ymaps.Placemark(
        [obj.latitude, obj.longitude],
        {
          hintContent: obj.hintContent,
          hintContent: obj.balloonContent
        },
        {
          iconLayout: "default#image",
          iconImageHref: "img/map/map-marker.png",
          iconImageSize: [46, 57],
          iconImageOffset: [-15, -50]
        }
      );

      myMap.geoObjects.add(myPlacemark);
    });

    myMap.behaviors.disable("scrollZoom");
  }

});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAvKkhhbWJ1cmdlciBtZW51Ki9cclxuICBsZXQgaGFtYnVyZ2VyID0gKG9wdGlvbnMgPT4ge1xyXG4gICAgbGV0IGJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy5idXR0b24pO1xyXG4gICAgbGV0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG9wdGlvbnMubWVudSk7XHJcbiAgICBsZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5XCIpO1xyXG5cclxuICAgIGxldCBpdGVtc0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hdl9fbGlzdC0taGFtYnVyZ2VyXCIpLmNoaWxkcmVuO1xyXG4gICAgaXRlbXNMaXN0ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoaXRlbXNMaXN0KTtcclxuXHJcbiAgICBjb25zdCBpdGVtcyA9ICQoXCIubmF2X19pdGVtXCIsIG1lbnUpO1xyXG4gICAgbGV0IGNvdW50ZXIgPSAwO1xyXG5cclxuICAgIGxldCBzdGFydE1lbnVBbmltYXRpb24gPSBmdW5jdGlvbiBzdGFydE1lbnVBbmltYXRpb24oKSB7XHJcbiAgICAgIGxldCBpdGVtID0gaXRlbXMuZXEoY291bnRlcik7XHJcbiAgICAgIGl0ZW0udG9nZ2xlQ2xhc3MoXCJwdWxzZVwiKTtcclxuICAgICAgY291bnRlcisrO1xyXG4gICAgICBpZiAoY291bnRlciA8IGl0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoc3RhcnRNZW51QW5pbWF0aW9uLCAxMDApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChjb3VudGVyID09PSBpdGVtcy5sZW5ndGgpIGNvdW50ZXIgPSAwO1xyXG4gICAgfTtcclxuXHJcbiAgICBsZXQgX3RvZ2dsZU1lbnUgPSBmdW5jdGlvbihlKSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICBtZW51LmNsYXNzTGlzdC50b2dnbGUoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZShcImxvY2tlZFwiKTtcclxuICAgICAgc3RhcnRNZW51QW5pbWF0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjbG9zZU1lbnUgPSBmdW5jdGlvbiBjbG9zZU1lbnUoKSB7XHJcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwiaXMtYWN0aXZlXCIpO1xyXG4gICAgICBtZW51LmNsYXNzTGlzdC5yZW1vdmUoXCJpcy1hY3RpdmVcIik7XHJcbiAgICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImxvY2tlZFwiKTtcclxuICAgICAgc3RhcnRNZW51QW5pbWF0aW9uKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIGxldCBhZGRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcclxuICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBfdG9nZ2xlTWVudSk7XHJcblxyXG4gICAgICBmb3IgKGkgPSAwOyBpIDwgaXRlbXNMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgaXRlbXNMaXN0W2ldLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZU1lbnUpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PSAyNykgY2xvc2VNZW51KCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpbml0OiBhZGRMaXN0ZW5lcnNcclxuICAgIH07XHJcbiAgfSkoe1xyXG4gICAgYnV0dG9uOiBcIiNoYW1idXJnZXItbWVudS1saW5rXCIsXHJcbiAgICBtZW51OiBcIiNoYW1idXJnZXItbWVudVwiXHJcbiAgfSk7XHJcblxyXG4gIGhhbWJ1cmdlci5pbml0KCk7XHJcblxyXG4gIC8qaG9yYWNjb3JkZW9uKi9cclxuICBsZXQgdGVhbUFjY29KUyA9ICgpID0+IHtcclxuICAgIGxldCBvVGVhbUxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRlYW1fX2FjY29yZGVvbi1saW5rXCIpO1xyXG5cclxuICAgIG9UZWFtTGluay5mb3JFYWNoKGZ1bmN0aW9uKHBlcnNvbk5hbWUpIHtcclxuXHJcbiAgICAgIHBlcnNvbk5hbWUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgbGV0IGFjdGl2ZVBlcnNvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudGVhbV9fYWNjb3JkZW9uLWl0ZW0uaXMtYWN0aXZlXCIpO1xyXG5cclxuICAgICAgICBpZiAoYWN0aXZlUGVyc29uKSB7XHJcbiAgICAgICAgICBsZXQgdGVhbUFjY29yZGVvbkRlc2MgPSBhY3RpdmVQZXJzb24ucXVlcnlTZWxlY3RvcihcIi50ZWFtX19hY2NvcmRlb24tZGVzY1wiKVxyXG5cclxuICAgICAgICAgIHRlYW1BY2NvcmRlb25EZXNjLnN0eWxlLmhlaWdodCA9IFwiMHB4XCI7XHJcbiAgICAgICAgICBhY3RpdmVQZXJzb24uY2xhc3NMaXN0LnJlbW92ZShcImlzLWFjdGl2ZVwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghYWN0aXZlUGVyc29uIHx8IGFjdGl2ZVBlcnNvbi5xdWVyeVNlbGVjdG9yKFwiLnRlYW1fX2FjY29yZGVvbi1saW5rXCIpICE9PSB0aGlzKSB7XHJcbiAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbiA9IHRoaXMuY2xvc2VzdChcIi50ZWFtX19hY2NvcmRlb24taXRlbVwiKTtcclxuICAgICAgICAgIGN1cnJlbnRQZXJzb24uY2xhc3NMaXN0LmFkZChcImlzLWFjdGl2ZVwiKTtcclxuXHJcbiAgICAgICAgICBsZXQgY3VycmVudFBlcnNvbkluZm8gPSBjdXJyZW50UGVyc29uLnF1ZXJ5U2VsZWN0b3IoXCIudGVhbV9fYWNjb3JkZW9uLWRlc2NcIik7XHJcbiAgICAgICAgICBjdXJyZW50UGVyc29uSW5mby5zdHlsZS5oZWlnaHQgPSBjdXJyZW50UGVyc29uSW5mby5zY3JvbGxIZWlnaHQgKyBcInB4XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICB9O1xyXG4gIHRlYW1BY2NvSlMoKTtcclxuXHJcbiAgLyp2ZXJhY2NvcmRlb24qL1xyXG4gIGxldCB2ZXJ0aWNhbEFjY28gPSAoKSA9PiB7XHJcbiAgICBsZXQgY2FsY3VsYXRlV2lkdGggPSAoKSA9PiB7XHJcbiAgICAgIGxldCB3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgICBsZXQgbGlua3MgPSAkKFwiLm1lbnVfX2FjY29yZGVvbi1saW5rXCIpO1xyXG4gICAgICBsZXQgbGlua3NXaWR0aCA9IGxpbmtzLndpZHRoKCk7XHJcbiAgICAgIGxldCByZXFXaWR0aCA9IHdpbmRvd1dpZHRoIC0gbGlua3NXaWR0aCAqIGxpbmtzLmxlbmd0aDtcclxuICAgICAgcmV0dXJuIHJlcVdpZHRoID4gNTUwID8gNTUwIDogcmVxV2lkdGg7XHJcbiAgICB9O1xyXG4gICAgbGV0IG9UZWFtTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubWVudV9fYWNjb3JkZW9uLWxpbmtcIik7XHJcbiAgICBvVGVhbUxpbmsuZm9yRWFjaChmdW5jdGlvbihwZXJzb25OYW1lKSB7XHJcblxyXG4gICAgICBwZXJzb25OYW1lLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGxldCBhY3RpdmVQZXJzb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1lbnVfX2FjY29yZGVvbi1pdGVtLmFjdGl2ZVwiKTtcclxuICAgICAgICAvLyBsZXQgb3RoZXJQZXJzb24gPSBkb2N1bWVudC5xdWVyeVNlbGxlY3RvckFsbChcIi5tZW51X19hY2NvcmRlb24taXRlbVwiKTtcclxuXHJcbiAgICAgICAgaWYgKGFjdGl2ZVBlcnNvbikge1xyXG4gICAgICAgICAgbGV0IHRlYW1BY2NvcmRlb25EZXNjID0gYWN0aXZlUGVyc29uLnF1ZXJ5U2VsZWN0b3IoXCIubWVudV9fYWNjb3JkZW9uLWNvbnRlbnRcIik7XHJcblxyXG4gICAgICAgICAgdGVhbUFjY29yZGVvbkRlc2Muc3R5bGUud2lkdGggPSBcIjBweFwiO1xyXG4gICAgICAgICAgYWN0aXZlUGVyc29uLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWFjdGl2ZVBlcnNvbiB8fCBhY3RpdmVQZXJzb24ucXVlcnlTZWxlY3RvcihcIi5tZW51X19hY2NvcmRlb24tbGlua1wiKSAhPT0gdGhpcykge1xyXG4gICAgICAgICAgbGV0IGN1cnJlbnRQZXJzb24gPSB0aGlzLmNsb3Nlc3QoXCIubWVudV9fYWNjb3JkZW9uLWl0ZW1cIik7XHJcbiAgICAgICAgICBjdXJyZW50UGVyc29uLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XHJcbiAgICAgICAgICBjdXJyZW50UGVyc29uLmNsYXNzTGlzdC5hZGQoXCJhY3RpdmVcIik7XHJcblxyXG4gICAgICAgICAgbGV0IGN1cnJlbnRQZXJzb25JbmZvID0gY3VycmVudFBlcnNvbi5xdWVyeVNlbGVjdG9yKFwiLm1lbnVfX2FjY29yZGVvbi1jb250ZW50XCIpO1xyXG4gICAgICAgICAgY3VycmVudFBlcnNvbkluZm8uc3R5bGUud2lkdGggPSBjYWxjdWxhdGVXaWR0aCgpICsgXCJweFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfTtcclxuICB2ZXJ0aWNhbEFjY28oKTtcclxuXHJcbiAgLypTbGlkZXIqL1xyXG4gIGxldCBvd2xDYXJvdXNlbCA9ICgpID0+IHtcclxuICAgIGNvbnN0IGJ1cmdlckNhcm91c2VsID0gJChcIi5zbGlkZXJfX2xpc3RcIikub3dsQ2Fyb3VzZWwoe1xyXG4gICAgICBpdGVtczogMSxcclxuICAgICAgbmF2OiB0cnVlLFxyXG4gICAgICBuYXZDb250YWluZXI6ICQoXCIuc2xpZGVyX19jb250cm9sc1wiKSxcclxuICAgICAgbmF2VGV4dDogW1wiXCIsIFwiXCJdLFxyXG4gICAgICBsb29wOiB0cnVlXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiLnNsaWRlcl9fYnRuLW5leHRcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBidXJnZXJDYXJvdXNlbC50cmlnZ2VyKFwibmV4dC5vd2wuY2Fyb3VzZWxcIik7XHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiLnNsaWRlcl9fYnRuLXByZXZcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBidXJnZXJDYXJvdXNlbC50cmlnZ2VyKFwicHJldi5vd2wuY2Fyb3VzZWxcIik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBvd2xDYXJvdXNlbCgpO1xyXG4gIFxyXG4gIC8qTW9kYWwqL1xyXG4gICQoJy5mZWVkYmFja19fYnRuJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihlKXtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICQoJy5vdmVybGF5LW1vZGFsJykuc2hvdygpO1xyXG4gICAgJCgnLm1vZGFsLWZlZWRiYWNrX19jb250ZW50JykudGV4dCgn0JzRi9GB0LvQuCDQstGB0LUg0L4g0L3QuNGFINC4INC+INC90LjRhSwg0L4g0L3QuNGFINC4INC+INC90LjRhS4g0J3QtdC70YzQt9GPINGD0YHRgtC+0Y/RgtGMLCDQvdC10LLQvtC30LzQvtC20L3QviDQt9Cw0LHRi9GC0YwuLi4g0J3QuNC60L7Qs9C00LAg0L3QtSDQtNGD0LzQsNC7LCDRh9GC0L4g0LHRg9C70L7Rh9C60Lgg0LzQvtCz0YPRgiDQsdGL0YLRjCDRgtCw0LrQuNC80Lgg0LzRj9Cz0LrQuNC80LgsINC60L7RgtC70LXRgtC60LAg0YLQsNC60L7QuSDRgdC+0YfQvdC+0LksINCwINGB0YvRgCDRgtCw0LrQuNC8INGA0LDRgdC/0LvQsNCy0LvQtdC90L3Ri9C8LiDQnNGL0YHQu9C4INCy0YHQtSDQviDQvdC40YUg0Lgg0L4g0L3QuNGFLCDQviDQvdC40YUg0Lgg0L4g0L3QuNGFLiDQndC10LvRjNC30Y8g0YPRgdGC0L7Rj9GC0YwsINC90LXQstC+0LfQvNC+0LbQvdC+INC30LDQsdGL0YLRjC4uLiDQndC40LrQvtCz0LTQsCDQvdC1INC00YPQvNCw0LssINGH0YLQviDQsdGD0LvQvtGH0LrQuCDQvNC+0LPRg9GCINCx0YvRgtGMINGC0LDQutC40LzQuCDQvNGP0LPQutC40LzQuCwg0LrQvtGC0LvQtdGC0LrQsCDRgtCw0LrQvtC5INGB0L7Rh9C90L7QuSwg0LAg0YHRi9GAINGC0LDQutC40Lwg0YDQsNGB0L/Qu9Cw0LLQu9C10L3QvdGL0LwuJyk7XHJcbiAgICAkKCcubW9kYWwtZmVlZGJhY2tfX3RpdGxlJykudGV4dCgn0JrQvtC90YHRgtCw0L3RgtC40L0g0YHQv9C40LvQsdC10YDQsycpO1xyXG4gICAgLy8gJChcImh0bWwsYm9keVwiKS5jc3MoXCJvdmVyZmxvd1wiLFwiaGlkZGVuXCIpO1xyXG4gIH0pO1xyXG4gICQoJy5tb2RhbC1mZWVkYmFja19fY2xvc2UnKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgJCgnLm92ZXJsYXktbW9kYWwnKS5oaWRlKCk7XHJcbiAgICAvLyAkKFwiaHRtbCxib2R5XCIpLmNzcyhcIm92ZXJmbG93XCIsXCJpbmhlcml0XCIpO1xyXG4gIH0pO1xyXG5cclxuICAvKkFKQVggZm9ybSovXHJcbiAgdmFyIGFqYXhGb3JtID0gZnVuY3Rpb24gKG1haW5mb3JtKSB7XHJcbiAgICBsZXQgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKFwibmFtZVwiLCBtYWluZm9ybS5lbGVtZW50cy5uYW1lLnZhbHVlKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKFwicGhvbmVcIiwgbWFpbmZvcm0uZWxlbWVudHMucGhvbmUudmFsdWUpO1xyXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJjb21tZW50XCIsIG1haW5mb3JtLmVsZW1lbnRzLmNvbW1lbnQudmFsdWUpO1xyXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJ0b1wiLCBcImt1ci5zZXJAbWFpbC5ydVwiKTtcclxuICAgIGxldCB1cmwgPSBcImh0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbFwiO1xyXG5cclxuICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyLnJlc3BvbnNlVHlwZSA9IFwianNvblwiO1xyXG4gICAgeGhyLm9wZW4oXCJQT1NUXCIsIHVybCk7XHJcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcclxuICAgIHhoci5zZW5kKGZvcm1EYXRhKTtcclxuICAgIC8veGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgcmV0dXJuIHhocjtcclxuICB9XHJcblxyXG4gIHZhciBzdWJtaXRGb3JtID0gZnVuY3Rpb24gKGUpe1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgdmFyIGZvcm0gPSBlLnRhcmdldDtcclxuICAgIGxldCByZXF1ZXN0ID0gYWpheEZvcm0obWFpbmZvcm0pO1xyXG5cclxuICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgaWYgKHJlcXVlc3Quc3RhdHVzID49IDQwMCkge1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gJ9Ce0YjQuNCx0LrQsCDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDRgdC10YDQstC10YDQvtC8LCDQv9C+0L/RgNC+0LHRg9C50YLQtSDQv9C+0LfQttC1Lic7XHJcbiAgICAgICAgJCgnLm1vZGFsLWZlZWRiYWNrX19jb250ZW50JykudGV4dChjb250ZW50ICsgJyDQntGI0LjQsdC60LAgJyArIHJlcXVlc3Quc3RhdHVzICsgJyEnKTtcclxuICAgICAgICAkKCcubW9kYWwtZmVlZGJhY2tfX3RpdGxlJykudGV4dCgn0KDQtdC30YPQu9GM0YLQsNGCINC+0YLQv9GA0LDQstC60LgnKTtcclxuICAgICAgICAkKCcub3ZlcmxheS1tb2RhbCcpLnNob3coKTtcclxuICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnJlc3BvbnNlLnN0YXR1cykge1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gcmVxdWVzdC5yZXNwb25zZS5tZXNzYWdlO1xyXG4gICAgICAgICQoJy5tb2RhbC1mZWVkYmFja19fY29udGVudCcpLnRleHQoY29udGVudCk7XHJcbiAgICAgICAgJCgnLm1vZGFsLWZlZWRiYWNrX190aXRsZScpLnRleHQoJ9Cg0LXQt9GD0LvRjNGC0LDRgiDQvtGC0L/RgNCw0LLQutC4Jyk7XHJcbiAgICAgICAgJCgnLm92ZXJsYXktbW9kYWwnKS5zaG93KCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IGNvbnRlbnQgPSByZXF1ZXN0LnJlc3BvbnNlLm1lc3NhZ2U7XHJcbiAgICAgICAgJCgnLm1vZGFsLWZlZWRiYWNrX19jb250ZW50JykudGV4dChjb250ZW50KTtcclxuICAgICAgICAkKCcubW9kYWwtZmVlZGJhY2tfX3RpdGxlJykudGV4dCgn0KDQtdC30YPQu9GM0YLQsNGCINC+0YLQv9GA0LDQstC60LgnKTtcclxuICAgICAgICAkKCcub3ZlcmxheS1tb2RhbCcpLnNob3coKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGxldCBteWZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFpbmZvcm0nKTtcclxuICBteWZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0Jywgc3VibWl0Rm9ybSk7XHJcblxyXG4gIHltYXBzLnJlYWR5KGluaXQpO1xyXG4gIHZhciBteU1hcCxcclxuICAgIG15UGxhY2VtYXJrLFxyXG4gICAgbXlQbGFjZW1hcmtzID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgbGF0aXR1ZGU6IDU5LjkxNTAzOCxcclxuICAgICAgICBsb25naXR1ZGU6IDMwLjQ4NjA5NixcclxuICAgICAgICBoaW50Q29udGVudDogXCJNci5CdXJnZXIg0L3QsCDQotC+0LLQsNGA0LjRidC10YHQutC+0LxcIixcclxuICAgICAgICBiYWxsb29uQ29udGVudDogXCLQotC+0LLQsNGA0LjRidC10YHQutC40Lkg0L/RgNC+0YHQv9C10LrRgiwgMjAvMjdcIlxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbGF0aXR1ZGU6IDU5Ljk0NzA4MzgxLFxyXG4gICAgICAgIGxvbmdpdHVkZTogMzAuMzg0ODE2ODgsXHJcbiAgICAgICAgaGludENvbnRlbnQ6IFwiTXIuQnVyZ2VyINC90LAg0KLQstC10YDRgdC60L7QuVwiLFxyXG4gICAgICAgIGJhbGxvb25Db250ZW50OiBcItCi0LLQtdGA0YHQutCw0Y8g0YPQu9C40YbQsCwgMTZcIlxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbGF0aXR1ZGU6IDU5Ljg5MTI5NSxcclxuICAgICAgICBsb25naXR1ZGU6IDMwLjMxNjkwNyxcclxuICAgICAgICBoaW50Q29udGVudDogXCJNci5CdXJnZXIg0L3QsCDQnNC+0YHQutC+0LLRgdC60L7QvFwiLFxyXG4gICAgICAgIGJhbGxvb25Db250ZW50OiBcItCc0L7RgdC60L7QstGB0LrQuNC5INC/0YDQvtGB0L/QtdC60YIsIDEwM9C6MlwiXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBsYXRpdHVkZTogNTkuOTczOTk5LFxyXG4gICAgICAgIGxvbmdpdHVkZTogMzAuMzExMDkxLFxyXG4gICAgICAgIGhpbnRDb250ZW50OiBcIk1yLkJ1cmdlciDQvdCwINCn0LDQv9GL0LPQuNC90LBcIixcclxuICAgICAgICBiYWxsb29uQ29udGVudDogXCLRg9C70LjRhtCwINCn0LDQv9GL0LPQuNC90LAsIDEz0JBcIlxyXG4gICAgICB9XHJcbiAgICBdO1xyXG5cclxuICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgICAgY2VudGVyOiBbNTkuOTI2MDY1NDgsIDMwLjMyNjEwODY5XSxcclxuICAgICAgem9vbTogMTFcclxuICAgIH0pO1xyXG5cclxuICAgIG15UGxhY2VtYXJrcy5mb3JFYWNoKGZ1bmN0aW9uKG9iaikge1xyXG4gICAgICBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXHJcbiAgICAgICAgW29iai5sYXRpdHVkZSwgb2JqLmxvbmdpdHVkZV0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgaGludENvbnRlbnQ6IG9iai5oaW50Q29udGVudCxcclxuICAgICAgICAgIGhpbnRDb250ZW50OiBvYmouYmFsbG9vbkNvbnRlbnRcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGljb25MYXlvdXQ6IFwiZGVmYXVsdCNpbWFnZVwiLFxyXG4gICAgICAgICAgaWNvbkltYWdlSHJlZjogXCJpbWcvbWFwL21hcC1tYXJrZXIucG5nXCIsXHJcbiAgICAgICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuICAgICAgICAgIGljb25JbWFnZU9mZnNldDogWy0xNSwgLTUwXVxyXG4gICAgICAgIH1cclxuICAgICAgKTtcclxuXHJcbiAgICAgIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrKTtcclxuICAgIH0pO1xyXG5cclxuICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKFwic2Nyb2xsWm9vbVwiKTtcclxuICB9XHJcblxyXG59KTtcclxuIl19
